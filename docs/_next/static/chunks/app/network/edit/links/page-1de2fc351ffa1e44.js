(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[818],{6176:function(t,e,i){Promise.resolve().then(i.bind(i,383))},383:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return K}});var o=i(7437),r=i(2265),s=i(5915),n=i(3004),l=i(9788),h=i(6104),a=i(639),d=i(7160),c=i(8058),p=i(990),u=i(6324),f=i(1155);i(2916),i(2954);var E=i(2694),g=i(5878),w=i(7687),y=i(9488),T=i(4692);let v="handsontableEditor";class m extends E.H{static get EDITOR_TYPE(){return"handsontable"}open(){super.open(),this.htEditor&&this.htEditor.destroy(),"none"===this.htContainer.style.display&&(this.htContainer.style.display=""),this.htEditor=new this.hot.constructor(this.htContainer,this.htOptions),this.htEditor.init(),this.htEditor.rootElement.style.display="",this.cellProperties.strict?this.htEditor.selectCell(0,0):this.htEditor.deselectCell(),(0,g.Mq)(this.TEXTAREA,0,this.TEXTAREA.value.length),this.refreshDimensions()}close(){this.htEditor&&(this.htEditor.rootElement.style.display="none"),this.removeHooksByKey("beforeKeyDown"),super.close()}prepare(t,e,i,o,r,s){super.prepare(t,e,i,o,r,s);let n=this,l={startRows:0,startCols:0,minRows:0,minCols:0,className:"listbox",copyPaste:!1,autoColumnSize:!1,autoRowSize:!1,readOnly:!0,fillHandle:!1,autoWrapCol:!1,autoWrapRow:!1,ariaTags:!1,afterOnCellMouseDown(t,e){let i=this.getSourceData(e.row,e.col);void 0!==i&&n.setValue(i),n.hot.destroyEditor()},preventWheel:!0,layoutDirection:this.hot.isRtl()?"rtl":"ltr"};this.cellProperties.handsontable&&(0,y.l7)(l,s.handsontable),this.htOptions=l}beginEditing(t,e){let i=this.hot.getSettings().onBeginEditing;i&&!1===i()||super.beginEditing(t,e)}createElements(){super.createElements();let t=this.hot.rootDocument.createElement("DIV");t.className="handsontableEditor",this.TEXTAREA_PARENT.appendChild(t),this.htContainer=t,this.assignHooks()}finishEditing(t,e,i){if(this.htEditor&&this.htEditor.isListening()&&this.hot.listen(),this.htEditor&&this.htEditor.getSelectedLast()){let t=this.htEditor.getValue();void 0!==t&&this.setValue(t)}super.finishEditing(t,e,i)}assignHooks(){this.hot.addHook("afterDestroy",()=>{this.htEditor&&this.htEditor.destroy()})}registerShortcuts(){let t=this.hot.getShortcutManager(),e=t.getContext("editor");super.registerShortcuts();let i={group:v,relativeToGroup:T.H,position:"before"},o=(t,e)=>{let i=this.htEditor;if(void 0!==t&&(t<0||i.flipped&&t>i.countRows()-1?i.deselectCell():i.selectCell(t,0),i.getData().length))return e.preventDefault(),(0,w.mM)(e),this.hot.listen(),this.TEXTAREA.focus(),!1};e.addShortcuts([{keys:[["ArrowUp"]],callback:t=>{let e;let i=this.htEditor;return!i.getSelectedLast()&&i.flipped?e=i.countRows()-1:i.getSelectedLast()&&(e=i.flipped?Math.max(0,i.getSelectedLast()[0]-1):i.getSelectedLast()[0]-1),o(e,t)},preventDefault:!1},{keys:[["ArrowDown"]],callback:t=>{let e;let i=this.htEditor;if(i.getSelectedLast()||i.flipped){if(i.getSelectedLast()){if(i.flipped)e=i.getSelectedLast()[0]+1;else if(!i.flipped){let t=i.countRows()-1;e=Math.min(t,i.getSelectedLast()[0]+1)}}}else e=0;return o(e,t)},preventDefault:!1}],i)}unregisterShortcuts(){super.unregisterShortcuts();let t=this.hot.getShortcutManager(),e=t.getContext("editor");e.removeShortcutsByGroup(v)}}var C=i(9440),A=i(2518),x=i(6411),R=i(6678),b=i(2228),S=i(9275),D=i(8200);function P(t,e,i){var o;return(e="symbol"==typeof(o=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?o:String(o))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function L(t,e){var i=function(t,e,i){if(!e.has(t))throw TypeError("attempted to get private field on non-instance");return e.get(t)}(t,e,0);return i.get?i.get.call(t):i.value}var k=new WeakMap;class N extends m{constructor(){var t;super(...arguments),P(this,"query",null),P(this,"strippedChoices",[]),P(this,"rawChoices",[]),t={writable:!0,value:this.hot.guid.slice(0,9)},function(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}(this,k),k.set(this,t),P(this,"sortByRelevance",function(t,e,i){let o,r,s,n;let l=[],h=[],a=t.length,d=e.length;if(0===a){for(s=0;s<d;s++)h.push(s);return h}for(s=0;s<d;s++){if(r=(0,x.oN)((0,A.Pz)(e[s])),i)n=r.indexOf(t);else{let e=this.cellProperties.locale;n=r.toLocaleLowerCase(e).indexOf(t.toLocaleLowerCase(e))}-1!==n&&(o=r.length-n-a,l.push({baseIndex:s,index:n,charsLeft:o,value:r}))}for(l.sort((t,e)=>{if(-1===e.index)return -1;if(-1===t.index)return 1;if(t.index<e.index)return -1;if(e.index<t.index)return 1;if(t.index===e.index){if(t.charsLeft<e.charsLeft)return -1;if(t.charsLeft>e.charsLeft)return 1}return 0}),s=0,d=l.length;s<d;s++)h.push(l[s].baseIndex);return h})}static get EDITOR_TYPE(){return"autocomplete"}getValue(){let t=this.rawChoices.find(t=>{let e=this.stripValueIfNeeded(t);return e===this.TEXTAREA.value});return(0,A.$K)(t)?t:this.TEXTAREA.value}createElements(){super.createElements(),(0,g.cn)(this.htContainer,"autocompleteEditor"),(0,g.cn)(this.htContainer,-1===this.hot.rootWindow.navigator.platform.indexOf("Mac")?"":"htMacScroll"),this.hot.getSettings().ariaTags&&(0,g.P$)(this.TEXTAREA,[(0,D.Nr)(),(0,D.LO)(),(0,D.fv)("listbox"),(0,D.zV)()])}prepare(t,e,i,o,r,s){super.prepare(t,e,i,o,r,s),this.hot.getSettings().ariaTags&&(0,g.P$)(this.TEXTAREA,[(0,D.JV)("false"),(0,D.d)(`${L(this,k)}-listbox-${t}-${e}`)])}open(){super.open();let t=void 0===this.cellProperties.trimDropdown||this.cellProperties.trimDropdown,e=this.hot.getSettings().ariaTags,i=Array.isArray(this.cellProperties.source)?this.cellProperties.source:null,o=null==i?void 0:i.length,{row:r,col:s}=this;this.showEditableElement(),this.focus();let n=(0,g.np)();0===n&&(0,b.eE)()&&(n+=15),this.addHook("beforeKeyDown",t=>this.onBeforeKeyDown(t)),this.htEditor.updateSettings({colWidths:t?[(0,g.iO)(this.TEXTAREA)-2]:void 0,width:t?(0,g.iO)(this.TEXTAREA)+n:void 0,autoColumnSize:!0,renderer:(t,r,s,n,l,h,a)=>{let d,c;(0,S.V)(t,r,s,n,l,h,a);let{filteringCaseSensitive:p,allowHtml:u,locale:f}=this.cellProperties,E=this.query,w=(0,A.Pz)(h);w&&!u&&-1!==(d=!0===p?w.indexOf(E):w.toLocaleLowerCase(f).indexOf(E.toLocaleLowerCase(f)))&&(c=w.substr(d,E.length),w=w.replace(c,`<strong>${c}</strong>`)),e&&(0,g.P$)(r,[(0,D.Nl)(),...i?[(0,D.DT)(o)]:[],...i?[(0,D.jH)(i.indexOf(h)+1)]:[],["id",`${this.htEditor.rootElement.id}_${s}-${n}`]]),r.innerHTML=w},afterSelection:(t,i)=>{if(e){let e=this.htEditor.getCell(t,i,!0);(0,g.P$)(e,[(0,D.Ak)()]),(0,g.P$)(this.TEXTAREA,...(0,D.nT)(e.id))}}}),e&&((0,g.P$)(this.htEditor.view._wt.wtOverlays.wtTable.TABLE,...(0,D.Rn)()),(0,g.P$)(this.htEditor.rootElement,[(0,D.a6)(),(0,D.Ez)("polite"),(0,D.Up)("text"),["id",`${L(this,k)}-listbox-${r}-${s}`]]),(0,g.P$)(this.TEXTAREA,...(0,D.JV)("true"))),this.hot._registerTimeout(()=>{this.queryChoices(this.TEXTAREA.value)})}close(){this.removeHooksByKey("beforeKeyDown"),super.close(),this.hot.getSettings().ariaTags&&(0,g.P$)(this.TEXTAREA,[(0,D.JV)("false")])}discardEditor(t){super.discardEditor(t),this.hot.view.render()}queryChoices(t){let e=this.cellProperties.source;this.query=t,"function"==typeof e?e.call(this.cellProperties,t,t=>{this.rawChoices=t,this.updateChoicesList(this.stripValuesIfNeeded(t))}):Array.isArray(e)?(this.rawChoices=e,this.updateChoicesList(this.stripValuesIfNeeded(e))):this.updateChoicesList([])}updateChoicesList(t){let e=(0,g.qK)(this.TEXTAREA),i=(0,g.kg)(this.TEXTAREA),o=this.cellProperties.sortByRelevance,r=this.cellProperties.filter,s=null,n=null,l=t;o&&(s=this.sortByRelevance(this.stripValueIfNeeded(this.getValue()),l,this.cellProperties.filteringCaseSensitive));let h=Array.isArray(s)?s.length:0;if(!1===r)h&&(n=s[0]);else{let t=[];for(let e=0,i=l.length;e<i&&(!o||!(h<=e));e++)h?t.push(l[s[e]]):t.push(l[e]);n=0,l=t}this.strippedChoices=l,this.htEditor.loadData((0,C.jz)([l])),0===l.length?this.htEditor.rootElement.style.display="none":(this.htEditor.rootElement.style.display="",this.updateDropdownHeight(),this.flipDropdownIfNeeded(),!0===this.cellProperties.strict&&this.highlightBestMatchingChoice(n)),this.hot.listen(),(0,g.Mq)(this.TEXTAREA,e,e===i?void 0:i)}flipDropdownIfNeeded(){let t=(0,g.$g)(this.hot.view._wt.wtTable.TABLE),e=t===this.hot.rootWindow,i=this.cellProperties.preventOverflow;if(e||!e&&(i||"horizontal"===i))return!1;let o=(0,g.cv)(this.TEXTAREA),r=(0,g.Pb)(this.TEXTAREA),s=this.getDropdownHeight(),n=t.scrollTop,l=(0,g.Pb)(this.hot.view._wt.wtTable.THEAD),h=(0,g.cv)(t),a=o.top-h.top-l+n,d=t.scrollHeight-a-l-r,c=s>d&&a>d;return c?this.flipDropdown(s):this.unflipDropdown(),this.limitDropdownIfNeeded(c?a:d,s),c}limitDropdownIfNeeded(t,e){if(e>t){let i=0,o=0,r=0,s=null;do i+=r=this.htEditor.getRowHeight(o)||this.htEditor.view._wt.getSetting("defaultRowHeight"),o+=1;while(i<t);s=i-r,this.htEditor.flipped&&(this.htEditor.rootElement.style.top=`${parseInt(this.htEditor.rootElement.style.top,10)+e-s}px`),this.setDropdownHeight(i-r)}}flipDropdown(t){let e=this.htEditor.rootElement.style;e.position="absolute",e.top=`${-t}px`,this.htEditor.flipped=!0}unflipDropdown(){let t=this.htEditor.rootElement.style;t.position="absolute",t.top="",this.htEditor.flipped=void 0}updateDropdownHeight(){let t=this.htEditor.getColWidth(0)+(0,g.np)(this.hot.rootDocument)+2,e=this.cellProperties.trimDropdown;this.htEditor.updateSettings({height:this.getDropdownHeight(),width:e?void 0:t}),this.htEditor.view._wt.wtTable.alignOverlaysWithTrimmingContainer()}setDropdownHeight(t){this.htEditor.updateSettings({height:t})}highlightBestMatchingChoice(t){"number"==typeof t?this.htEditor.selectCell(t,0,void 0,void 0,void 0,!1):this.htEditor.deselectCell()}getDropdownHeight(){let t=this.htEditor.getRowHeight(0)||23,e=this.cellProperties.visibleRows;return this.strippedChoices.length>=e?e*t:this.strippedChoices.length*t+8}stripValueIfNeeded(t){return this.stripValuesIfNeeded([t])[0]}stripValuesIfNeeded(t){let{allowHtml:e}=this.cellProperties,i=(0,C.Sc)(t,t=>(0,A.Pz)(t)),o=(0,C.Sc)(i,t=>e?t:(0,x.oN)(t));return o}allowKeyEventPropagation(t){let e=this.htEditor.getSelectedRangeLast(),i={row:e?e.from.row:-1},o=!1;return t===R.nx.ARROW_DOWN&&i.row>0&&i.row<this.htEditor.countRows()-1&&(o=!0),t===R.nx.ARROW_UP&&i.row>-1&&(o=!0),o}onBeforeKeyDown(t){if((0,R.EA)(t.keyCode)||t.keyCode===R.nx.BACKSPACE||t.keyCode===R.nx.DELETE||t.keyCode===R.nx.INSERT){let e=10;t.keyCode===R.nx.C&&(t.ctrlKey||t.metaKey)||(this.isOpened()||(e+=10),this.htEditor&&this.hot._registerTimeout(()=>{this.queryChoices(this.TEXTAREA.value)},e))}}}var _=i(4317);class O extends N{static get EDITOR_TYPE(){return"dropdown"}prepare(t,e,i,o,r,s){super.prepare(t,e,i,o,r,s),this.cellProperties.filter=!1,this.cellProperties.strict=!0}}_.Z.getSingleton().add("beforeValidate",function(t,e,i){let o=this.getCellMeta(e,this.propToCol(i));o.editor===O&&void 0===o.strict&&(o.filter=!1,o.strict=!0)});var H=i(1881);function I(t,e,i,o,r,s,n){H.Z.apply(this,[t,e,i,o,r,s,n]),(0,g.uS)(e,null==s?"":s,!1)}I.RENDERER_TYPE="html";var V=i(9773);function $(t,e,i,o,r,s,n){let{rootDocument:l}=t,h=n.allowHtml?I:S.V,a=l.createElement("DIV"),d=t.getSettings().ariaTags;if(a.className="htAutocompleteArrow",d&&a.setAttribute(...(0,D.cV)()),a.appendChild(l.createTextNode(String.fromCharCode(9660))),h.apply(this,[t,e,i,o,r,s,n]),e.firstChild||e.appendChild(l.createTextNode(String.fromCharCode(160))),e.insertBefore(a,e.firstChild),(0,g.cn)(e,"htAutocomplete"),!t.acArrowListener){let r=new V.Z(t);t.acArrowListener=function(r){(0,g.pv)(r.target,"htAutocompleteArrow")&&t.view._wt.getSetting("onCellDblClick",null,t._createCellCoords(i,o),e)},r.addEventListener(t.rootElement,"mousedown",t.acArrowListener),t.addHookOnce("afterDestroy",()=>{r.destroy()})}}function X(t,e,i,o,r,s,n){$.apply(this,[t,e,i,o,r,s,n])}function j(t,e){let i=t;if(null==i&&(i=""),this.allowEmpty&&""===i){e(!0);return}this.strict&&this.source?"function"==typeof this.source?this.source(i,M(i,e)):M(i,e)(this.source):e(!0)}function M(t,e){return function(i){let o=!1;for(let e=0,r=i.length;e<r;e++)if(t===i[e]){o=!0;break}e(o)}}function B(t,e){j.apply(this,[t,e])}$.RENDERER_TYPE="autocomplete",X.RENDERER_TYPE="dropdown",j.VALIDATOR_TYPE="autocomplete",B.VALIDATOR_TYPE="dropdown";var W=i(2037),z=i(6735);function K(){let[t,e]=(0,r.useState)({nodes:[],links:[]}),[i,s]=(0,r.useState)(!0),n=(0,r.useRef)(null);if((0,r.useEffect)(()=>{fetch("/books.json").then(t=>t.json()).then(t=>{e(t),s(!1)}).catch(t=>{console.error("Failed to fetch data",t),s(!1)})},[]),i)return(0,o.jsx)("div",{children:"Loading..."});let l=t.nodes.map(t=>t.id).sort();return(0,o.jsxs)("div",{style:{padding:"20px"},children:[(0,o.jsx)("h1",{children:"Edit Links"}),(0,o.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,o.jsx)("button",{onClick:()=>window.location.href="/network/edit",style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer",marginRight:"10px",backgroundColor:"#666",color:"white",border:"none"},children:"Back to Dashboard"}),(0,o.jsx)("button",{onClick:()=>{if(!n.current)return;let e=n.current.hotInstance,i=e.getSourceData(),o={nodes:t.nodes,links:i};fetch("/api/books/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(t=>{t.ok?alert("Saved successfully!"):t.json().then(e=>{alert("Failed to save: ".concat(e.error||t.statusText))}).catch(()=>{alert("Failed to save: Unknown error")})}).catch(t=>{console.error("Error saving:",t),alert("Error saving data: ".concat(t.message))})},style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer",marginRight:"10px"},children:"Save Changes"}),(0,o.jsx)("button",{onClick:()=>{if(!n.current)return;let t=n.current.hotInstance;t.alter("insert_row_below",t.countRows(),1)},style:{padding:"10px 20px",fontSize:"16px",cursor:"pointer",backgroundColor:"#4CAF50",color:"white",border:"none"},children:"Add Link"})]}),(0,o.jsx)(z.sZ,{ref:n,data:t.links,colHeaders:["Source (ID)","Target (ID)","Description"],columns:[{data:"source",type:"dropdown",source:l},{data:"target",type:"dropdown",source:l},{data:"description"}],colWidths:[200,200,300],dropdownMenu:!0,contextMenu:!0,filters:!0,rowHeaders:!0,manualRowMove:!0,autoWrapRow:!0,autoWrapCol:!0,licenseKey:"non-commercial-and-evaluation",height:"auto"})]})}i(6800),(0,u.xN)(f.i),(0,u.xN)({CELL_TYPE:"dropdown",editor:O,renderer:X,validator:B}),(0,u.xN)(W.o),(0,s.fo)(n.lV),(0,s.fo)(l.Gf),(0,s.fo)(h.xV),(0,s.fo)(a._x),(0,s.fo)(d.h_),(0,s.fo)(c.x$),(0,s.fo)(p.E9)}},function(t){t.O(0,[121,66,990,281,971,472,744],function(){return t(t.s=6176)}),_N_E=t.O()}]);